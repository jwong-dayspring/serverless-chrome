service: serverless-chrome

provider:
  name: aws
  runtime: nodejs6.10
  stage: dev
  region: us-east-1
  environment:
    CHROME_PATH: ./headless-chrome/headless_shell

custom:
  webpackIncludeModules: false # disable auto including modules

plugins:
  - serverless-webpack

functions:
  run:
    description: Run headless Chromium
    memorySize: 1536
    timeout: 30
    handler: handler.run

    events:
      - http:
          path: chrome
          method: post
          integration: lambda
          contentHandling: CONVERT_TO_BINARY
          request:
            template:
              text/html: '#set($allParams = $input.params())
              { 
                "body" : "$util.base64Encode($input.body)",
                "params" : {
                  #foreach($type in $allParams.keySet())
                  #set($params = $allParams.get($type))
                  "$type" : {
                    #foreach($paramName in $params.keySet())
                    "$paramName" : "$util.escapeJavaScript($params.get($paramName))"
                    #if($foreach.hasNext),#end
                    #end
                  }
                  #if($foreach.hasNext),#end
                  #end
                }
              }
              '
          response:
            headers:
              Content-Type: "'application/pdf'"
#            template: $util.base64Decode($input.path('$.content'))
